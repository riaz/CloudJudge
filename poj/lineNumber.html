<!DOCTYPE HTML>
<html>
<head>
	<title>Line Numbering</title>		
	<style type="text/css">
		#wrapper{
			margin:0px;
			padding:0px;
		}
		ul#line{
			padding:0px;	
			margin-top:20px;				
			background-color: gray;	
			color: white;
			text-align: center;
			list-style-type: none;
			float:left;
			width: 15px;
			height:100px;		
		}
		#edit{
			padding:0px;
			margin-top:20px;
			width:500px;
			height:500px;					
			float:left;
			background-color: #0A0A2A;	
			color: white;
			overflow:scroll;
		}
	</style>
</head>
<body>
<div id="wrapper">
	<ul id="line">
		<li>1</li>
		<li>2</li>
		<li>3</li>
		<li>4</li>
		<li>5</li>		
	</ul>
	<div id="edit" contentEditable="true"></div>
</div>
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript">
$(function() {
	$object = $('#edit');
	$incrementer=0;
	$height=0;	
    editorInit($('#edit'));
});
</script>
<script type="text/javascript">

function editorInit()
{
	$div = $object.clone().empty().appendTo($object.parent());
	$incrementer = $('<span>a</span>').appendTo($div).height();
	$height = $div.height();
	$div.remove();		
}

function addLine()
{
	$height = $incrementer + $height;
	$object[0].setAttribute('style','height:'+$height+'px');
}

function removeLine()
{
	$height = $height - $incrementer;
	$object[0].setAttribute('style','height:'+$height+'px');
}

function countNumRows(obj)
{
	
	$measureDiv = obj.clone().empty().appendTo(obj.parent());
	$span = $('<span>a</span>').appendTo($measureDiv);	
	$incrementer = $span.height();
	/*console.log('Incrementer');
	console.log($incrementer);
	console.log('Height Parent:');
	console.log(obj.context.height);	
	console.log('Height Clone:');
	console.log($measureDiv.height());
	$incrementer = $incrementer + obj.context.height;
	obj[0].setAttribute('style','height:'+$incrementer+'px');
	console.log('get Attribute');
	console.log(obj[0].getAttribute('style'));

	console.log('Height after increment:');
	console.log(obj.context.height);*/

	$rows = Math.floor($measureDiv.height()/$span.height());
	$measureDiv.remove();

	return $rows;
}

//console.log(countNumRows($("#edit")));
 
$("#edit").keydown(function(event){
	
		var TAB_KEY = 9;
		var ENTER_KEY = 13;
		var DELETE_KEY = 46;
	
		if(event.keyCode == TAB_KEY){
		
			notelyAction('indent');
			
			if(event.preventDefault){
			
				event.preventDefault();
			
			}
		
		}
		if(event.keyCode == ENTER_KEY)	{
			addLine();
		}
		if(event.keyCode == DELETE_KEY){
			removeLine();
		}
});

function notelyAction(action){
	document.execCommand('styleWithCSS', true, null);
	document.execCommand(action, true, null);
}
$('#edit').focus(function(){
    var s = window.getSelection();
    var t = 'savedRange'+$(this).attr('id');
    if (window[t] != null && s.rangeCount > 0)
        s.removeAllRanges();
    s.addRange(window[t]);
}).bind("mouseup keyup",function(){
    var t = 'savedRange'+$(this).attr('id');
    window[t] = window.getSelection().getRangeAt(0);
}).on("mousedown click",function(e){
    if(!$(this).is(":focus")){
        e.stopPropagation();
        e.preventDefault();
        $(this).focus();
    }
});

</script>
</body>
</html>
